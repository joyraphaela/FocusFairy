<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FocusFairy: Anti-Distraction Study App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #8a2be2 0%, #ff69b4 50%, #fbc2eb 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }
    .container {
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 25px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      padding: 3rem;
      max-width: 90%;
      width: 550px;
      text-align: center;
      position: relative;
      z-index: 10;
      backdrop-filter: blur(5px);
    }
    video {
      border-radius: 20px;
      width: 100%;
      max-width: 450px;
      height: auto;
      margin: 2rem auto;
      display: block;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      aspect-ratio: 16 / 9;
      object-fit: cover;
    }
    button {
      background: linear-gradient(45deg, #a770ef, #cf8bf3, #fbc2eb);
      color: #fff;
      padding: 1rem 2.5rem;
      border-radius: 12px;
      font-weight: 700;
      transition: all 0.3s ease;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
      border: none;
      cursor: pointer;
      font-size: 1.125rem;
    }
    button:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
    }
    input[type="number"], select {
      border-radius: 12px;
      border: 1px solid #d1d5db;
      padding: 0.8rem 1.2rem;
      width: 100%;
      max-width: 250px;
      margin: 0 auto;
      text-align: center;
      font-size: 1.1rem;
      color: #374151;
    }
    input[type="number"]:focus, select:focus {
      border-color: #8a2be2;
      outline: none;
      box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.2);
    }
    .dreamy-element {
      position: absolute;
      opacity: 0.6;
      animation: float 20s infinite ease-in-out alternate;
      z-index: 0;
      filter: blur(1px);
    }
    .cloud1 { top: 8%; left: -8%; width: 180px; height: 100px; background-color: rgba(255,255,255,0.75); border-radius: 50%; box-shadow: 0 0 25px rgba(255,255,255,0.6); animation-duration: 28s; }
    .cloud2 { bottom: 15%; right: -12%; width: 220px; height: 120px; background-color: rgba(255,255,255,0.75); border-radius: 50%; box-shadow: 0 0 25px rgba(255,255,255,0.6); animation-duration: 33s; animation-delay: 5s; }
    .sparkle1 { top: 5%; right: 15%; font-size: 3.5rem; color: #fff; text-shadow: 0 0 12px #fff; animation: sparkle 3s infinite ease-in-out alternate; animation-delay: 1s; }
    .sparkle2 { bottom: 10%; left: 20%; font-size: 2.5rem; color: #fff; text-shadow: 0 0 12px #fff; animation: sparkle 3.5s infinite ease-in-out alternate; animation-delay: 2s; }
    .sparkle3 { top: 30%; left: 5%; font-size: 3rem; color: #fff; text-shadow: 0 0 12px #fff; animation: sparkle 2.8s infinite ease-in-out alternate; animation-delay: 0.5s; }
    @keyframes float {
      0% { transform: translateY(0) translateX(0); }
      50% { transform: translateY(-30px) translateX(30px); }
      100% { transform: translateY(0) translateX(0); }
    }
    @keyframes sparkle {
      0% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.3); }
      100% { opacity: 0.6; transform: scale(1); }
    }
    .distraction-overlay {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(255, 105, 180, 0.3);
      border-radius: 25px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease-in-out;
      z-index: 5;
    }
    .distraction-overlay.active {
      animation: flashOverlay 0.5s ease-in-out;
    }
    @keyframes flashOverlay {
      0% { opacity: 0; }
      50% { opacity: 1; }
      100% { opacity: 0; }
    }
  </style>
</head>
<body class="p-4">

  <div class="dreamy-element cloud1"></div>
  <div class="dreamy-element cloud2"></div>
  <div class="dreamy-element sparkle1">âœ¨</div>
  <div class="dreamy-element sparkle2">ðŸŒŸ</div>
  <div class="dreamy-element sparkle3">ðŸ’«</div>

  <div class="container relative">
    <div id="initial-screen">
      <h1 class="text-5xl font-extrabold text-purple-700 mb-4">FocusFairy</h1>
      <p class="text-gray-700 text-lg mb-8 max-w-sm mx-auto">Tingkatkan fokus belajarmu dengan aplikasi anti-distraksi yang menenangkan.</p>

      <div class="space-y-6">
        <div>
          <label for="study-duration" class="block text-gray-800 text-lg font-semibold mb-2">Durasi Belajar (menit):</label>
          <input type="number" id="study-duration" value="25" min="1" />
        </div>
        <div>
          <label for="background-sound" class="block text-gray-800 text-lg font-semibold mb-2">Pilih Suara Latar:</label>
          <select id="background-sound">
            <option value="none">Tidak Ada</option>
            <option value="rain">Hujan Rintik</option>
            <option value="ocean">Ombak Laut</option>
            <option value="relax">Musik Relaksasi</option>
          </select>
        </div>
      </div>

      <button id="start-button" class="mt-10">Mulai Belajar</button>
    </div>

    <div id="study-screen" class="hidden">
      <h2 class="text-4xl font-extrabold text-purple-700 mb-4">Sesi Belajar Aktif</h2>
      <p class="text-gray-700 text-lg mb-2">Tetap fokus ya!</p>
      <p class="text-xl font-semibold mb-4">Gangguan terdeteksi: <span id="distraction-counter" class="text-pink-600 font-bold">0</span></p>
      <p id="timer-display" class="text-7xl font-extrabold text-purple-800 mb-8">00:00</p>
      <video id="video" autoplay muted></video>
      <div class="distraction-overlay" id="distraction-animation-overlay"></div>
    </div>

    <div id="summary-screen" class="hidden">
      <h2 class="text-4xl font-extrabold text-purple-700 mb-4">Sesi Selesai! ðŸŽ‰</h2>
      <p class="text-gray-700 text-lg mb-8">Kerja bagus! Mari lihat hasilnya:</p>
      <div class="text-left text-gray-800 text-xl space-y-4 mb-10 mx-auto max-w-xs">
        <p>Total Waktu Belajar: <span id="summary-total-time" class="font-bold text-pink-600">0 menit</span></p>
        <p>Jumlah Gangguan: <span id="summary-distractions" class="font-bold text-pink-600">0</span></p>
        <p>Level Fokus: <span id="summary-focus-level" class="font-extrabold"></span></p>
      </div>
      <button id="restart-button">Belajar Lagi</button>
    </div>
  </div>

  <script>
    const video = document.getElementById('video');
    const startButton = document.getElementById('start-button');
    const restartButton = document.getElementById('restart-button');
    const initialScreen = document.getElementById('initial-screen');
    const studyScreen = document.getElementById('study-screen');
    const summaryScreen = document.getElementById('summary-screen');
    const distractionCounterDisplay = document.getElementById('distraction-counter');
    const timerDisplay = document.getElementById('timer-display');
    const distractionOverlay = document.getElementById('distraction-animation-overlay');
    const summaryTotalTime = document.getElementById('summary-total-time');
    const summaryDistractions = document.getElementById('summary-distractions');
    const summaryFocusLevel = document.getElementById('summary-focus-level');
    const studyDurationInput = document.getElementById('study-duration');
    const backgroundSoundSelect = document.getElementById('background-sound');

    let distractionCount = 0;
    let remainingTime = 0;
    let timerInterval;
    let studyStartTime;
    let model;
    const backgroundAudio = new Audio();
    backgroundAudio.loop = true;
    backgroundAudio.volume = 0.5;
    const soundUrls = {
      none: '',
      rain: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
      ocean: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
      relax: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3'
    };

    async function setupCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
      await video.play();
      await loadModel();
      detectObjects();
    }

    async function loadModel() {
      model = await cocoSsd.load();
    }

    async function detectObjects() {
      if (!video || video.readyState !== 4) {
        requestAnimationFrame(detectObjects);
        return;
      }
      const predictions = await model.detect(video);
      if (predictions.some(p => p.class === 'cell phone' && p.score > 0.6)) {
        distractionCount++;
        distractionCounterDisplay.textContent = distractionCount;
        distractionOverlay.classList.add('active');
        setTimeout(() => distractionOverlay.classList.remove('active'), 500);
      }
      setTimeout(() => requestAnimationFrame(detectObjects), 2000);
    }

    function startTimer() {
      const duration = parseInt(studyDurationInput.value);
      if (!duration || duration <= 0) return;
      remainingTime = duration * 60;
      studyStartTime = Date.now();
      updateTimer();
      timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      const minutes = Math.floor(remainingTime / 60);
      const seconds = remainingTime % 60;
      timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      if (remainingTime <= 0) {
        clearInterval(timerInterval);
        endSession();
      } else {
        remainingTime--;
      }
    }

    function endSession() {
      backgroundAudio.pause();
      backgroundAudio.currentTime = 0;
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
      }
      studyScreen.classList.add('hidden');
      summaryScreen.classList.remove('hidden');
      const total = Math.round((Date.now() - studyStartTime) / 60000);
      summaryTotalTime.textContent = `${total} menit`;
      summaryDistractions.textContent = distractionCount;
      const focus = distractionCount < 3 ? 'Super Fokus' : distractionCount <= 6 ? 'Cukup Fokus' : 'Perlu Usaha Lagi';
      summaryFocusLevel.textContent = focus;
      distractionCount = 0;
      distractionCounterDisplay.textContent = '0';
    }

    function playBackgroundSound(key) {
      const url = soundUrls[key];
      if (url) {
        backgroundAudio.src = url;
        backgroundAudio.play().catch(e => console.log(e));
      } else {
        backgroundAudio.pause();
        backgroundAudio.currentTime = 0;
      }
    }

    startButton.addEventListener('click', () => {
      initialScreen.classList.add('hidden');
      studyScreen.classList.remove('hidden');
      playBackgroundSound(backgroundSoundSelect.value);
      setupCamera();
      startTimer();
    });

    restartButton.addEventListener('click', () => {
      summaryScreen.classList.add('hidden');
      initialScreen.classList.remove('hidden');
      timerDisplay.textContent = '00:00';
    });
  </script>
</body>
</html>
